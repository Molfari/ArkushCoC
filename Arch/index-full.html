<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Аркуш Дослідника: Поклик Ктулху (1920-ті)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=Marck+Script&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ===== File: css/main.css ===== */
        body {
            font-family: 'Special Elite', monospace;
            background-color: #F3EFE3;
            color: #3a3a3a;
        }
        .sheet-container {
            max-width: 900px;
            margin: 1rem auto;
            padding: 1.5rem;
            border: 3px double #5a4a3a;
            background-color: #FFFBF2;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
        }
        h1, h2 {
            font-family: 'Marck Script', cursive;
            text-align: center;
            margin-bottom: 1rem;
        }
        h1 { font-size: 2.5rem; }
        h2 {
            font-size: 1.5rem;
            font-family: 'Special Elite', monospace;
            font-weight: bold;
            border-top: 2px solid #5a4a3a;
            border-bottom: 2px solid #5a4a3a;
            padding: 0.25rem 0;
            margin-top: 1.5rem;
            text-transform: uppercase;
        }
        label {
            font-size: 0.8rem;
            color: #5a4a3a;
            text-transform: uppercase;
        }
        input[type="text"], input[type="number"], textarea {
            font-family: 'Special Elite', monospace;
            border: none;
            background-color: transparent;
            padding: 0.1rem 0;
            font-size: 1rem;
            width: 100%;
        }
        input:focus, textarea:focus { outline: none; }
        input[readonly] {
            pointer-events: none;
        }
        .header-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.5rem 1.5rem;
            margin-bottom: 1.5rem;
        }
        .header-grid input {
            border-bottom: 1px dotted #3a3a3a;
            text-align: left;
        }
        .main-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        .char-box, .stat-box {
            border: 1px solid #8a7a6a;
            text-align: center;
        }
        .char-box label, .stat-box label {
            display: block;
            padding: 0.25rem;
            border-bottom: 1px solid #8a7a6a;
        }
        .value-split {
            display: grid;
            grid-template-columns: 2fr 1fr;
            grid-template-rows: 1fr 1fr;
            height: 80px;
        }
        .main-value {
            grid-column: 1 / 2;
            grid-row: 1 / 3;
            border-right: 1px solid #8a7a6a;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .main-value input { font-size: 2rem; font-weight: bold; text-align: center;}
        .half-value, .fifth-value {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
        }
        .half-value { border-bottom: 1px solid #8a7a6a; }

        .stat-values {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            padding: 0.5rem;
        }
        .stat-values div { flex: 1; }
        .stat-values input {
            font-size: 1.5rem;
            text-align: center;
            font-weight: bold;
            border-bottom: 1px dotted #3a3a3a;
        }
        .status-block {
            border: 1px solid #8a7a6a;
            margin-top: 1rem;
        }
        .status-block h3 {
            font-size: 1rem;
            padding: 0.25rem;
            border-bottom: 1px solid #8a7a6a;
            text-align: center;
            font-weight: bold;
        }
        .status-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
        }
        .checkbox-group { display: flex; align-items: center; gap: 0.5rem; }
        .checkbox-group label { text-transform: none; }

        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 0.5rem 1.5rem;
            margin-top: 1rem;
        }
        .skill-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .skill-item label { flex-grow: 1; text-transform: none; }
        .skill-value-box {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            width: 120px;
            border: 1px solid #8a7a6a;
            text-align: center;
        }
        .skill-value-box input, .skill-value-box span { padding: 0.25rem; }
        .skill-value-box > * { border-right: 1px solid #8a7a6a; }
        .skill-value-box > *:last-child { border-right: none; }

        .weapons-table { width: 100%; margin-top: 1rem; border-collapse: collapse; }
        .weapons-table th, .weapons-table td {
            border: 1px solid #8a7a6a;
            padding: 0.5rem;
            text-align: center;
        }
        .weapons-table th { font-size: 0.8rem; }
        .weapons-table input { text-align: center; border-bottom: 1px dotted #3a3a3a; }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #5a4a3a;
            margin-bottom: 1rem;
        }
        .tab-button {
            padding: 0.5rem 1rem;
            cursor: pointer;
            background-color: transparent;
            border: none;
            font-family: 'Special Elite', monospace;
            font-size: 1.2rem;
            border-bottom: 3px solid transparent;
        }
        .tab-button.active {
            border-bottom: 3px solid #3a3a3a;
            font-weight: bold;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .backstory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        .backstory-item textarea {
            min-height: 120px;
            border: 1px dotted #8a7a6a;
            padding: 0.5rem;
        }
        .memo-box {
            border: 1px solid #8a7a6a;
            padding: 1rem;
            margin-top: 1rem;
        }
        .memo-box h3 {
            font-weight: bold;
            text-align: center;
            margin-bottom: 0.5rem;
        }
        .memo-box ul {
            list-style-type: disc;
            list-style-position: inside;
            padding-left: 1rem;
        }
        .memo-box li { margin-bottom: 0.25rem; }
    </style>
</head>
<body class="p-4">

    <div class="sheet-container">
        <div class="tabs">
            <button class="tab-button active" data-tab="character-sheet">
                Персонаж
            </button>
            <button class="tab-button" data-tab="backstory-sheet">
                Нотатки
            </button>
        </div>

        <!-- TAB 1: CHARACTER SHEET -->
        <div id="character-sheet" class="tab-content active">
            <h1>Лист Дослідника</h1>
            <div class="header-grid" id="info-container">
                <!-- Генерується JS -->
            </div>

            <h2>Характеристики</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4" id="stats-container">
                <!-- Генерується JS -->
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-4" id="current-stats-container">
                <!-- Генерується JS -->
            </div>

            <div class="status-block">
                <h3>СТАНИ</h3>
                <div class="status-grid">
                    <div class="checkbox-group"><input type="checkbox" id="temp_insane"><label for="temp_insane">Тимчасове божевілля</label></div>
                    <div class="checkbox-group"><input type="checkbox" id="indef_insane"><label for="indef_insane">Повне божевілля</label></div>
                    <div class="checkbox-group"><input type="checkbox" id="major_wound"><label for="major_wound">Глибока рана</label></div>
                    <div class="checkbox-group"><input type="checkbox" id="unconscious"><label for="unconscious">Непритомність</label></div>
                    <div class="checkbox-group"><input type="checkbox" id="dying"><label for="dying">При смерті</label></div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4" id="derived-stats-container">
                 <!-- Генерується JS -->
            </div>

            <h2>Вміння</h2>
            <div class="skills-grid" id="skills-container"></div>

            <h2>Зброя</h2>
            <table class="weapons-table">
                <thead><tr><th>Зброя</th><th>Вміння %</th><th>Пошкодж.</th><th>Дальність</th><th>Атак</th><th>Набоїв</th><th>Несправн.</th></tr></thead>
                <tbody>
                    <tr><td><input type="text" value="Рукопашний бій"></td><td><input type="number" value="25"></td><td><input type="text" value="1D3+БП"></td><td><input type="text" value="Дотик"></td><td><input type="number" value="1"></td><td><input type="text" value="-"></td><td><input type="text" value="-"></td></tr>
                    <tr><td><input type="text"></td><td><input type="number"></td><td><input type="text"></td><td><input type="text"></td><td><input type="number"></td><td><input type="text"></td><td><input type="text"></td></tr>
                </tbody>
            </table>
        </div>

        <!-- TAB 2: NOTES -->
        <div id="backstory-sheet" class="tab-content">
            <h2>Передісторія</h2>
            <div class="backstory-grid">
                <div class="backstory-item"><label>Опис зовнішності</label><textarea></textarea></div>
                <div class="backstory-item"><label>Риси</label><textarea></textarea></div>
            </div>
        </div>
    </div>

    <script type="module">
        // ===== File: js/data/skillsData.js =====
        const skillsData = [
            { name: "Антропологія", base: 1 }, { name: "Археологія", base: 1 },
            { name: "Бій (рукопашний)", base: 25 }, { name: "Бухгалтерія", base: 5 },
            { name: "Верхова їзда", base: 5 }, { name: "Виживання", base: 10 },
            { name: "Вистежування", base: 10 }, { name: "Водіння (авто)", base: 20 },
            { name: "Вправність рук", base: 10 }, { name: "Достаток", base: 0 },
            { name: "Залякування", base: 15 }, { name: "Історія", base: 5 },
            { name: "Кидання", base: 20 }, { name: "Користування бібліотекою", base: 20 },
            { name: "Лазіння", base: 20 }, { name: "Маскування", base: 5 },
            { name: "Медицина", base: 1 }, { name: "Мистецтво/Ремесло", base: 5 },
            { name: "Міти Ктулху", base: 0 }, { name: "Мова (іноземна)", base: 1 },
            { name: "Мова (рідна)", base: "edu", readonly: true }, { name: "Наука", base: 1 },
            { name: "Непомітність", base: 20 }, { name: "Обман", base: 5 },
            { name: "Окультизм", base: 5 }, { name: "Орієнтування", base: 10 },
            { name: "Оцінка майна", base: 5 }, { name: "Переконливість", base: 10 },
            { name: "Перша допомога", base: 30 }, { name: "Пілотування", base: 1 },
            { name: "Плавання", base: 20 }, { name: "Пошук прихованого", base: 25 },
            { name: "Правознавство", base: 5 }, { name: "Природознавство", base: 10 },
            { name: "Психоаналіз", base: 1 }, { name: "Психологія", base: 10 },
            { name: "Ремонт (електрика)", base: 10 }, { name: "Ремонт (механіка)", base: 10 },
            { name: "Слух", base: 20 }, { name: "Слюсарство", base: 1 },
            { name: "Стрибок", base: 20 }, { name: "Стрільба (пістолет)", base: 20 },
            { name: "Стрільба (гвинтівка/дробовик)", base: 25 }, { name: "Ухиляння", base: "dex", readonly: true },
            { name: "Шарм", base: 15 }
        ];

        // ===== File: js/utils/calculations.js =====
        const calculateDBAndBuild = (str, siz) => {
            const total = str + siz;
            if (total <= 64) return { db: '-2', build: -2 };
            if (total <= 84) return { db: '-1', build: -1 };
            if (total <= 124) return { db: '+0', build: 0 };
            if (total <= 164) return { db: '+1D4', build: 1 };
            if (total <= 204) return { db: '+1D6', build: 2 };
            if (total <= 284) return { db: '+2D6', build: 3 };
            return { db: '+3D6', build: 4 };
        };

        const calculateMoveRate = (str, dex, siz, age) => {
            let moveRate = 8;
            if (str < siz && dex < siz) moveRate = 7;
            else if (str > siz && dex > siz) moveRate = 9;
            
            if (age >= 80) moveRate -= 5;
            else if (age >= 70) moveRate -= 4;
            else if (age >= 60) moveRate -= 3;
            else if (age >= 50) moveRate -= 2;
            else if (age >= 40) moveRate -= 1;
            
            return moveRate;
        };

        // ===== File: js/main.js =====

        // Центральний об'єкт для зберігання всіх даних
        const state = {
            info: { name: 'Джон Доу', occupation: 'Детектив', player: 'Гравець 1', age: 35, gender: 'Чоловік', birthplace: 'Аркхем', residence: 'Бостон' },
            stats: { str: 50, con: 50, siz: 50, dex: 50, app: 50, int: 50, pow: 50, edu: 50 },
            currentStats: { hp: 10, mp: 10, san: 50, sanMax: 99 },
            skills: {}
        };

        // Функція для оновлення DOM на основі поточного стану
        function updateUI() {
            // Оновлення характеристик
            for (const [key, value] of Object.entries(state.stats)) {
                const el = document.getElementById(key);
                if (el && el.value != value) el.value = value;
                document.getElementById(`${key}_half`).textContent = Math.floor(value / 2);
                document.getElementById(`${key}_fifth`).textContent = Math.floor(value / 5);
            }

            // Розрахунок та оновлення похідних характеристик
            const { str, con, siz, dex, pow, edu } = state.stats;
            const { age } = state.info;

            const hpMax = Math.floor((con + siz) / 10);
            document.getElementById('hp_max').value = hpMax;

            const mpMax = Math.floor(pow / 5);
            document.getElementById('mp_max').value = mpMax;
            
            document.getElementById('san_start').value = pow;

            const { db, build } = calculateDBAndBuild(str, siz);
            document.getElementById('db').value = db;
            document.getElementById('build').value = build;

            const moveRate = calculateMoveRate(str, dex, siz, age);
            document.getElementById('move_rate').value = moveRate;
            
            // Оновлення вмінь
            skillsData.forEach(skill => {
                const skillId = skill.name.toLowerCase().replace(/[\s()/]/g, '_');
                let value;
                 if (skill.base === 'edu') {
                    value = edu;
                } else if (skill.base === 'dex') {
                    value = Math.floor(dex / 2);
                } else {
                    value = state.skills[skillId] || skill.base;
                }
                const el = document.getElementById(skillId);
                if (el && el.value != value) el.value = value;
                document.getElementById(`${skillId}_half`).textContent = Math.floor(value / 2);
                document.getElementById(`${skillId}_fifth`).textContent = Math.floor(value / 5);
            });
        }
        
        // Функції для генерації початкового HTML
        function generateHTML() {
            const infoContainer = document.getElementById('info-container');
            infoContainer.innerHTML = `
                <div><label>Ім'я</label><input type="text" id="name" value="${state.info.name}"></div>
                <div><label>Рід занять</label><input type="text" id="occupation" value="${state.info.occupation}"></div>
                <div><label>Гравець</label><input type="text" id="player" value="${state.info.player}"></div>
                <div><label>Вік</label><input type="number" id="age" value="${state.info.age}"></div>
                <div><label>Стать</label><input type="text" id="gender" value="${state.info.gender}"></div>
                <div><label>Місце народження</label><input type="text" id="birthplace" value="${state.info.birthplace}"></div>
                <div><label>Місце проживання</label><input type="text" id="residence" value="${state.info.residence}"></div>
            `;

            const statsContainer = document.getElementById('stats-container');
            const statsOrder = [
                {id: 'str', name: 'Сила (СИЛ)'}, {id: 'con', name: 'Статура (СТА)'}, {id: 'siz', name: 'Розмір (РОЗ)'}, {id: 'dex', name: 'Спритність (СПР)'},
                {id: 'app', name: 'Зовнішність (ЗОВ)'}, {id: 'int', name: 'Інтелект (ІНТ)'}, {id: 'pow', name: 'Сила Волі (ВОЛ)'}, {id: 'edu', name: 'Освіта (ОСВ)'}
            ];
            statsContainer.innerHTML = statsOrder.map(s => `
                <div class="char-box"><label>${s.name}</label><div class="value-split"><div class="main-value"><input type="number" id="${s.id}" value="${state.stats[s.id]}"></div><div class="half-value" id="${s.id}_half"></div><div class="fifth-value" id="${s.id}_fifth"></div></div></div>
            `).join('');

            const currentStatsContainer = document.getElementById('current-stats-container');
            currentStatsContainer.innerHTML = `
                <div class="stat-box"><label>Очки здоров'я</label><div class="stat-values"><div><input type="number" id="hp_current"><label>Поточне</label></div><div><input type="number" id="hp_max" readonly><label>Макс.</label></div></div></div>
                <div class="stat-box"><label>Очки магії</label><div class="stat-values"><div><input type="number" id="mp_current"><label>Поточне</label></div><div><input type="number" id="mp_max" readonly><label>Макс.</label></div></div></div>
                <div class="stat-box"><label>Глузд</label><div class="stat-values"><div><input type="number" id="san_current"><label>Поточний</label></div><div><input type="number" id="san_start" readonly><label>Початк.</label></div></div></div>
                <div class="stat-box"><label>Макс. глузд</label><div class="stat-values p-1"><input type="number" id="san_max" class="text-2xl font-bold"></div></div>
            `;

            const derivedStatsContainer = document.getElementById('derived-stats-container');
            derivedStatsContainer.innerHTML = `
                <div class="char-box"><label>Бонусні пошкодження</label><div class="value-split"><div class="main-value"><input type="text" id="db" readonly></div><div class="half-value">-</div><div class="fifth-value">-</div></div></div>
                <div class="char-box"><label>Будова</label><div class="value-split"><div class="main-value"><input type="text" id="build" readonly></div><div class="half-value">-</div><div class="fifth-value">-</div></div></div>
                <div class="char-box"><label>Переміщення</label><div class="value-split"><div class="main-value"><input type="text" id="move_rate" readonly></div><div class="half-value">-</div><div class="fifth-value">-</div></div></div>
            `;
            
            const skillsContainer = document.getElementById('skills-container');
            skillsContainer.innerHTML = skillsData.map(skill => {
                 const skillId = skill.name.toLowerCase().replace(/[\s()/]/g, '_');
                 return `
                    <div class="skill-item">
                        <label>${skill.name} (${skill.base}%):</label>
                        <div class="skill-value-box">
                            <input type="number" id="${skillId}" ${skill.readonly ? 'readonly' : ''}>
                            <span id="${skillId}_half"></span>
                            <span id="${skillId}_fifth"></span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Функція для налаштування всіх слухачів подій
        function addEventListeners() {
            document.querySelector('.sheet-container').addEventListener('input', (e) => {
                if (e.target.tagName !== 'INPUT') return;
                
                const id = e.target.id;
                const value = parseInt(e.target.value, 10) || 0;

                if (state.stats.hasOwnProperty(id)) {
                    state.stats[id] = value;
                } else if (state.info.hasOwnProperty(id)) {
                    state.info[id] = e.target.type === 'number' ? value : e.target.value;
                } else if (state.currentStats.hasOwnProperty(id)) {
                     state.currentStats[id] = value;
                } else {
                    const isSkill = skillsData.some(s => s.name.toLowerCase().replace(/[\s()/]/g, '_') === id);
                    if (isSkill) {
                        state.skills[id] = value;
                    }
                }
                updateUI();
            });

            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    document.querySelectorAll('.tab-button, .tab-content').forEach(el => el.classList.remove('active'));
                    e.target.classList.add('active');
                    document.getElementById(e.target.dataset.tab).classList.add('active');
                });
            });
        }
        
        // Ініціалізація додатку
        function init() {
            generateHTML();
            // Встановлюємо початкові значення для поточних статів
            state.currentStats.hp = Math.floor((state.stats.con + state.stats.siz) / 10);
            state.currentStats.mp = Math.floor(state.stats.pow / 5);
            state.currentStats.san = state.stats.pow;
            document.getElementById('hp_current').value = state.currentStats.hp;
            document.getElementById('mp_current').value = state.currentStats.mp;
            document.getElementById('san_current').value = state.currentStats.san;
            document.getElementById('san_max').value = state.currentStats.sanMax;

            updateUI();
            addEventListeners();
        }

        init();

    </script>
</body>
</html>